<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini AI í¬íŠ¸í´ë¦¬ì˜¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .positive { color: #2ecc71; }
        .negative { color: #e74c3c; }
        .neutral { color: #95a5a6; }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-backdrop {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        
        /* ë²„íŠ¼ ë¹„í™œì„±í™” ìŠ¤íƒ€ì¼ */
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }

        /* ëª¨ë°”ì¼ í™”ë©´ì—ì„œ í…Œì´ë¸” ë ˆì´ì•„ì›ƒ ìµœì í™” */
        @media (max-width: 768px) {
            .mobile-table thead { display: none; }
            .mobile-table tr {
                display: block;
                border: 1px solid #e2e8f0;
                border-radius: 0.5rem;
                margin-bottom: 1rem;
                padding: 1rem;
            }
            .mobile-table td {
                display: flex;
                justify-content: space-between;
                padding: 0.5rem 0;
                border-bottom: 1px solid #f1f5f9;
                align-items: center;
            }
            .mobile-table td:last-child { border-bottom: none; }
            .mobile-table td::before {
                content: attr(data-label);
                font-weight: 600;
                margin-right: 1rem;
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <header class="mb-8 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">âœ¨ ë‚˜ì˜ AI ì•”í˜¸í™”í í¬íŠ¸í´ë¦¬ì˜¤</h1>
            <p class="text-gray-600 mt-2">Gemini AIì™€ í•¨ê»˜ ìì‚° í˜„í™©ì„ ë¶„ì„í•˜ê³  ì¶”ì í•˜ì„¸ìš”.</p>
        </header>

        <!-- ì…ë ¥ ì„¹ì…˜ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4">APIë¡œ ì½”ì¸ ì¶”ê°€ (ìë™ ì¶”ì )</h2>
                <div class="space-y-4">
                    <input type="text" id="coin-ticker" placeholder="ì½”ì¸ í‹°ì»¤ (ì˜ˆ: BTC, ETH)" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="number" id="coin-quantity" placeholder="ë³´ìœ  ìˆ˜ëŸ‰ (ì˜ˆ: 0.5)" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button id="add-coin-btn" onclick="addApiCoin()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-md hover:bg-blue-700 transition-colors">APIë¡œ ì¶”ê°€</button>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4">ìˆ˜ë™ìœ¼ë¡œ ìì‚° ì¶”ê°€ (ì§ì ‘ ì…ë ¥)</h2>
                <div class="space-y-4">
                    <input type="text" id="manual-name" placeholder="ìì‚° ì´ë¦„ (ì˜ˆ: Jupiter)" class="w-full p-3 border border-gray-300 rounded-md">
                    <input type="number" id="manual-quantity" placeholder="ë³´ìœ  ìˆ˜ëŸ‰ (ì˜ˆ: 1000)" class="w-full p-3 border border-gray-300 rounded-md">
                    <input type="number" id="manual-value" placeholder="ì´ í‰ê°€ì•¡ (USD)" class="w-full p-3 border border-gray-300 rounded-md">
                    <button onclick="addManualAsset()" class="w-full bg-green-600 text-white font-bold py-3 rounded-md hover:bg-green-700 transition-colors">ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€</button>
                </div>
            </div>
             <div class="bg-white p-6 rounded-lg shadow-md md:col-span-2">
                <h2 class="text-xl font-semibold mb-4">ë¶€ì±„ ê´€ë¦¬</h2>
                <div class="space-y-4">
                    <input type="number" id="debt-input" placeholder="ì´ ë¶€ì±„ (USD ë‹¨ìœ„ë¡œ ì…ë ¥)" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <button onclick="updateDebt()" class="w-full bg-indigo-600 text-white font-bold py-3 rounded-md hover:bg-indigo-700 transition-colors">ë¶€ì±„ ì—…ë°ì´íŠ¸</button>
                </div>
            </div>
        </div>

        <!-- ìì‚° ìš”ì•½ ë° AI ë¶„ì„ -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <div class="flex justify-between items-center mb-4 flex-wrap gap-2">
                 <h2 class="text-2xl font-bold">ìì‚° ìš”ì•½</h2>
                 <div class="flex gap-2">
                    <button onclick="openPredictionModal()" class="bg-cyan-600 text-white font-bold py-2 px-4 rounded-md hover:bg-cyan-700 transition-colors text-sm">âœ¨ AI ë¯¸ë˜ ìì‚° ì˜ˆì¸¡</button>
                    <button onclick="analyzePortfolio()" class="bg-purple-600 text-white font-bold py-2 px-4 rounded-md hover:bg-purple-700 transition-colors text-sm">âœ¨ AI í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„</button>
                 </div>
            </div>
            <div id="summary-section" class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                <div><p class="text-gray-500">ì´ ìì‚°</p><p id="total-assets-usd" class="text-xl font-bold">$0.00</p></div>
                <div><p class="text-gray-500">ì´ ë¶€ì±„</p><p id="total-debt-usd" class="text-xl font-bold text-red-500">$0.00</p></div>
                <div><p class="text-gray-500">ìˆœ ìì‚° (USD)</p><p id="net-assets-usd" class="text-xl font-bold text-blue-600">$0.00</p></div>
                <div><p class="text-gray-500">ìˆœ ìì‚° (KRW)</p><p id="net-assets-krw" class="text-xl font-bold text-green-600">â‚©0</p></div>
            </div>
        </div>

        <!-- í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„¸ ë° ì°¨íŠ¸ -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-bold mb-4">í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„¸</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full text-left mobile-table">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="p-4 font-semibold">ìì‚°</th>
                                <th class="p-4 font-semibold">ë³´ìœ  ìˆ˜ëŸ‰</th>
                                <th class="p-4 font-semibold">í˜„ì¬ê°€</th>
                                <th class="p-4 font-semibold">24h ë³€ë™</th>
                                <th class="p-4 font-semibold cursor-pointer" onclick="handleSort('value')">
                                    <div class="flex items-center">
                                        <span>í‰ê°€ì•¡</span>
                                        <span id="sort-indicator-value" class="ml-1"></span>
                                    </div>
                                </th>
                                <th class="p-4 font-semibold">AI ë‰´ìŠ¤</th>
                                <th class="p-4 font-semibold">ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="portfolio-table"></tbody>
                    </table>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-bold mb-4">ìì‚° êµ¬ì„±</h2>
                <div class="relative h-64 md:h-80"><canvas id="portfolio-pie-chart"></canvas></div>
            </div>
        </div>
        
        <footer class="text-center mt-8 text-gray-500 text-sm">
            <p>ë°ì´í„°ëŠ” 5ë¶„ë§ˆë‹¤ ìë™ìœ¼ë¡œ ê°±ì‹ ë©ë‹ˆë‹¤.</p>
            <p>Powered by CoinGecko & Gemini API</p>
        </footer>
    </div>

    <!-- AI ë¶„ì„ ê²°ê³¼ ëª¨ë‹¬ -->
    <div id="ai-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden modal-backdrop opacity-0">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col modal-content scale-95">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 id="modal-title" class="text-xl font-bold">AI ë¶„ì„ ê²°ê³¼</h3>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            </div>
            <div id="modal-body" class="p-6 overflow-y-auto">
                <!-- AI ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤. -->
            </div>
            <div id="modal-footer" class="p-4 bg-gray-50 border-t text-right space-x-2">
                <!-- ëª¨ë‹¬ ì•¡ì…˜ ë²„íŠ¼ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤. -->
            </div>
        </div>
    </div>

    <script>
        // --- ì „ì—­ ë³€ìˆ˜ ë° ì´ˆê¸° ì„¤ì • ---
        const PORTFOLIO_KEY = 'myPortfolio_kr_ai_v12';
        const DEBT_KEY = 'myDebt_kr_ai_v12';
        let portfolio = JSON.parse(localStorage.getItem(PORTFOLIO_KEY)) || [];
        let debt = JSON.parse(localStorage.getItem(DEBT_KEY)) || 0;
        let portfolioWithData = [];
        let coinList = [];
        let pieChart;
        let sortState = { key: 'value', direction: 'desc' };
        let krwRate = 1300;

        // ì£¼ìš” ì½”ì¸ í‹°ì»¤-ID ìš°ì„ ìˆœìœ„ ë§µ
        const TickerToIdMap = {
            'btc': 'bitcoin', 'eth': 'ethereum', 'xrp': 'ripple', 'sol': 'solana',
            'bnb': 'binancecoin', 'ada': 'cardano', 'doge': 'dogecoin', 'usdt': 'tether',
            'usdc': 'usd-coin', 'mask': 'mask-network', 'pepe': 'pepe',
            'jup': 'jupiter-aggregator', 'pengu': 'pudgy-penguins'
        };

        // --- ë°ì´í„° ê´€ë¦¬ í•¨ìˆ˜ ---
        function addApiCoin() {
            const ticker = document.getElementById('coin-ticker').value.toLowerCase().trim();
            const quantity = parseFloat(document.getElementById('coin-quantity').value);
            if (!ticker || !quantity || quantity <= 0) { showErrorModal("ìœ íš¨í•œ ì½”ì¸ í‹°ì»¤ì™€ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”."); return; }
            
            let id = TickerToIdMap[ticker];
            if (id) {
                processCoinAddition(id, quantity, false);
                return;
            }

            const foundCoins = coinList.filter(c => c.symbol.toLowerCase() === ticker);
            if (foundCoins.length === 0) {
                showErrorModal(`'${ticker.toUpperCase()}' í‹°ì»¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
            } else if (foundCoins.length === 1) {
                processCoinAddition(foundCoins[0].id, quantity, false);
            } else {
                showCoinSelectionModal(foundCoins, quantity);
            }
        }

        function addManualAsset() {
            const name = document.getElementById('manual-name').value.trim();
            const quantity = parseFloat(document.getElementById('manual-quantity').value);
            const value = parseFloat(document.getElementById('manual-value').value);

            if (!name || isNaN(quantity) || isNaN(value) || quantity < 0 || value < 0) {
                showErrorModal("ìœ íš¨í•œ ìì‚° ì´ë¦„, ìˆ˜ëŸ‰, í‰ê°€ì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.");
                return;
            }
            
            const manualAsset = {
                id: `manual_${Date.now()}`,
                name: name,
                quantity: quantity,
                value: value,
                isManual: true
            };
            
            portfolio.push(manualAsset);
            saveAndRefresh();
            
            document.getElementById('manual-name').value = '';
            document.getElementById('manual-quantity').value = '';
            document.getElementById('manual-value').value = '';
        }

        function processCoinAddition(id, quantity, isManual, name = null, value = null) {
            const existingCoin = portfolio.find(c => c.id === id);
            if (existingCoin) {
                existingCoin.quantity += quantity;
            } else {
                const newAsset = { id, quantity, isManual };
                if(isManual) {
                    newAsset.name = name;
                    newAsset.value = value;
                }
                portfolio.push(newAsset);
            }
            saveAndRefresh();
            document.getElementById('coin-ticker').value = '';
            document.getElementById('coin-quantity').value = '';
        }

        function updateQuantity(id, isManual) {
            const quantityInput = document.getElementById(`quantity-input-${id}`);
            const newQuantity = parseFloat(quantityInput.value);
            if (isNaN(newQuantity) || newQuantity < 0) {
                showErrorModal("ìœ íš¨í•œ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }
            
            const coinToUpdate = portfolio.find(c => c.id === id);
            if (coinToUpdate) {
                coinToUpdate.quantity = newQuantity;
                if(isManual) {
                    const valueInput = document.getElementById(`value-input-${id}`);
                    const newValue = parseFloat(valueInput.value);
                     if (isNaN(newValue) || newValue < 0) {
                        showErrorModal("ìœ íš¨í•œ í‰ê°€ì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                        return;
                    }
                    coinToUpdate.value = newValue;
                }
                saveAndRefresh();
            }
        }
        
        function removeCoin(id) {
            const coin = portfolio.find(c => c.id === id);
            const displayName = coin.isManual ? coin.name : (coinList.find(c => c.id === id)?.symbol.toUpperCase() || id);
            
            const title = 'ì‚­ì œ í™•ì¸';
            const bodyHTML = `<p>'${displayName}' ìì‚°ì„ í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>`;
            const footerHTML = `
                <button onclick="closeModal()" class="bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-md hover:bg-gray-400">ì·¨ì†Œ</button>
                <button onclick="executeRemove('${id}')" class="bg-red-600 text-white font-bold py-2 px-4 rounded-md hover:bg-red-700">ì‚­ì œ</button>
            `;
            openCustomModal(title, bodyHTML, footerHTML);
        }

        function executeRemove(id) {
            portfolio = portfolio.filter(c => c.id !== id);
            saveAndRefresh();
            closeModal();
        }
        
        function updateDebt() {
            const debtInput = document.getElementById('debt-input');
            if (debtInput) {
                const newDebt = parseFloat(debtInput.value);
                debt = isNaN(newDebt) || newDebt < 0 ? 0 : newDebt;
                saveAndRefresh();
            }
        }
        
        function saveAndRefresh() {
            localStorage.setItem(PORTFOLIO_KEY, JSON.stringify(portfolio));
            localStorage.setItem(DEBT_KEY, JSON.stringify(debt));
            fetchData();
        }

        // --- API í˜¸ì¶œ ë° ë°ì´í„° ì²˜ë¦¬ ---
        async function fetchCoinList() {
            const addBtn = document.getElementById('add-coin-btn');
            addBtn.disabled = true;
            addBtn.innerText = 'ì½”ì¸ ëª©ë¡ ë¡œë”© ì¤‘...';
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/coins/list');
                if (!response.ok) throw new Error('ì½”ì¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                coinList = await response.json();
                addBtn.disabled = false;
                addBtn.innerText = 'APIë¡œ ì¶”ê°€';
            } catch (error) {
                console.error(error);
                addBtn.innerText = 'ë¡œë”© ì‹¤íŒ¨';
                showErrorModal(`ì½”ì¸ ëª©ë¡ ë¡œë”©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            }
        }

        async function fetchData() {
            const apiCoins = portfolio.filter(p => !p.isManual);
            const manualAssets = portfolio.filter(p => p.isManual);

            if (apiCoins.length === 0) {
                portfolioWithData = [...manualAssets];
                renderPortfolio();
                updateSummary(manualAssets.reduce((sum, asset) => sum + asset.value, 0));
                return;
            }
            
            const [rateResult, coinResult] = await Promise.allSettled([
                fetch(`https://api.frankfurter.app/latest?from=USD&to=KRW`),
                fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${apiCoins.map(c => c.id).join(',')}&vs_currencies=usd&include_24hr_change=true`)
            ]);

            let apiError = false;

            if (rateResult.status === 'fulfilled' && rateResult.value.ok) {
                const rateData = await rateResult.value.json();
                krwRate = rateData.rates.KRW;
            } else {
                console.warn("í™˜ìœ¨ ì •ë³´ ë¡œë”© ì‹¤íŒ¨. ì´ì „ ê°’ ì‚¬ìš©.");
                apiError = true;
            }

            let totalApiAssetsUsd = 0;
            let apiAssetsWithData = [];

            if (coinResult.status === 'fulfilled' && coinResult.value.ok) {
                const coinData = await coinResult.value.json();
                apiAssetsWithData = apiCoins.map(coin => {
                    const data = coinData[coin.id];
                    if (data) {
                        const value = coin.quantity * (data.usd || 0);
                        totalApiAssetsUsd += value;
                        return { ...coin, name: coin.id, currentPrice: data.usd || 0, change24h: data.usd_24h_change || 0, value };
                    }
                    return null;
                }).filter(Boolean);
            } else {
                console.error("ì½”ì¸ ê°€ê²© ì •ë³´ ë¡œë”© ì‹¤íŒ¨.");
                apiAssetsWithData = portfolioWithData.filter(p => !p.isManual && p.value !== undefined);
                totalApiAssetsUsd = apiAssetsWithData.reduce((sum, asset) => sum + (asset.value || 0), 0);
                apiError = true;
            }

            if (apiError) {
                showErrorModal("APIì—ì„œ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì¼ë¶€ ì •ë³´ëŠ” ì´ì „ ë°ì´í„°ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            }

            const totalManualAssetsUsd = manualAssets.reduce((sum, asset) => sum + asset.value, 0);
            portfolioWithData = [...apiAssetsWithData, ...manualAssets];
            renderPortfolio();
            updateSummary(totalApiAssetsUsd + totalManualAssetsUsd);
        }

        // --- í™”ë©´ ë Œë”ë§ ë° ì •ë ¬ í•¨ìˆ˜ ---
        function handleSort(key) {
            if (sortState.key === key) {
                sortState.direction = sortState.direction === 'desc' ? 'asc' : 'desc';
            } else {
                sortState.key = key;
                sortState.direction = 'desc';
            }
            renderPortfolio();
        }
        
        function updateSortIndicator() {
            document.querySelectorAll('[id^="sort-indicator-"]').forEach(el => el.innerHTML = '');
            const indicatorEl = document.getElementById(`sort-indicator-${sortState.key}`);
            if (indicatorEl) indicatorEl.innerHTML = sortState.direction === 'desc' ? 'â–¼' : 'â–²';
        }

        function renderPortfolio() {
            const tableBody = document.getElementById("portfolio-table");
            tableBody.innerHTML = '';
            updateSortIndicator();
            if (portfolioWithData.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="7" class="text-center p-8 text-gray-500">í¬íŠ¸í´ë¦¬ì˜¤ì— ìì‚°ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.</td></tr>`;
                return;
            }
            const sortedData = [...portfolioWithData].sort((a, b) => {
                if (a[sortState.key] < b[sortState.key]) return sortState.direction === 'asc' ? -1 : 1;
                if (a[sortState.key] > b[sortState.key]) return sortState.direction === 'asc' ? 1 : -1;
                return 0;
            });
            sortedData.forEach(asset => {
                const row = document.createElement('tr');
                let displayName, currentPrice, change24h, value, quantityHtml, aiNewsHtml;

                if (asset.isManual) {
                    displayName = `${asset.name} (ìˆ˜ë™)`;
                    currentPrice = 'N/A';
                    change24h = 'N/A';
                    value = asset.value;
                    quantityHtml = `
                        <div class="flex items-center">
                            <input type="number" id="quantity-input-${asset.id}" class="w-24 p-1 border rounded-md" value="${asset.quantity}" step="any" min="0">
                            <input type="number" id="value-input-${asset.id}" class="w-24 p-1 border rounded-md ml-2" value="${asset.value}" step="any" min="0">
                            <button onclick="updateQuantity('${asset.id}', true)" class="ml-2 bg-green-500 text-white text-xs font-bold py-1 px-2 rounded-md hover:bg-green-600">ìˆ˜ì •</button>
                        </div>
                    `;
                    aiNewsHtml = `<button class="bg-gray-400 text-white text-xs font-bold py-1 px-3 rounded-md cursor-not-allowed">N/A</button>`;
                } else {
                    const coinTickerInfo = coinList.find(c => c.id === asset.id);
                    displayName = coinTickerInfo ? coinTickerInfo.symbol.toUpperCase() : asset.name;
                    currentPrice = `$${asset.currentPrice.toLocaleString()}`;
                    change24h = `${(asset.change24h || 0).toFixed(2)}%`;
                    value = asset.value;
                    quantityHtml = `
                        <div class="flex items-center">
                            <input type="number" id="quantity-input-${asset.id}" class="w-24 p-1 border rounded-md" value="${asset.quantity}" step="any" min="0">
                            <button onclick="updateQuantity('${asset.id}', false)" class="ml-2 bg-green-500 text-white text-xs font-bold py-1 px-2 rounded-md hover:bg-green-600">ìˆ˜ì •</button>
                        </div>
                    `;
                    aiNewsHtml = `<button onclick="getCoinNews('${asset.id}')" class="bg-teal-500 text-white text-xs font-bold py-1 px-3 rounded-md hover:bg-teal-600">âœ¨ ë³´ê¸°</button>`;
                }
                
                const changeClass = (asset.change24h || 0) > 0 ? 'positive' : ((asset.change24h || 0) < 0 ? 'negative' : 'neutral');

                row.innerHTML = `
                    <td data-label="ìì‚°" class="p-4 font-semibold">${displayName}</td>
                    <td data-label="ë³´ìœ  ìˆ˜ëŸ‰" class="p-4">${quantityHtml}</td>
                    <td data-label="í˜„ì¬ê°€" class="p-4">${currentPrice}</td>
                    <td data-label="24h ë³€ë™" class="p-4 font-bold ${changeClass}">${change24h}</td>
                    <td data-label="í‰ê°€ì•¡" class="p-4 font-semibold">$${value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                    <td data-label="AI ë‰´ìŠ¤" class="p-4">${aiNewsHtml}</td>
                    <td data-label="ê´€ë¦¬" class="p-4"><button onclick="removeCoin('${asset.id}')" class="bg-red-500 text-white text-xs font-bold py-1 px-3 rounded-md hover:bg-red-600">ì‚­ì œ</button></td>
                `;
                tableBody.appendChild(row);
            });
        }

        function updateSummary(totalAssetsUsd) {
            const netAssetsUsd = totalAssetsUsd - debt;
            const netAssetsKrw = netAssetsUsd * krwRate;
            const formatUSD = (num) => `$${num.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            const formatKRW = (num) => `â‚©${num.toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;
            document.getElementById('total-assets-usd').innerText = formatUSD(totalAssetsUsd);
            document.getElementById('total-debt-usd').innerText = formatUSD(debt);
            document.getElementById('net-assets-usd').innerText = formatUSD(netAssetsUsd);
            document.getElementById('net-assets-krw').innerText = formatKRW(netAssetsKrw);
            const chartLabels = portfolioWithData.map(c => c.isManual ? c.name : (coinList.find(ci => ci.id === c.id)?.symbol.toUpperCase() || c.name));
            const chartData = portfolioWithData.map(c => c.value);
            updatePieChart(chartLabels, chartData);
        }
        function updatePieChart(labels, data) {
            const ctx = document.getElementById('portfolio-pie-chart').getContext('2d');
            const chartColors = ['#4F46E5', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#3B82F6', '#EC4899', '#6B7280'];
            if (pieChart) {
                pieChart.data.labels = labels;
                pieChart.data.datasets[0].data = data;
                pieChart.data.datasets[0].backgroundColor = chartColors.slice(0, data.length);
                pieChart.update();
                return;
            }
            pieChart = new Chart(ctx, {
                type: 'pie',
                data: { labels, datasets: [{ data, backgroundColor: chartColors.slice(0, data.length), hoverOffset: 4 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { padding: 15, font: { size: 14 } } } } }
            });
        }

        // --- Gemini AI ê¸°ëŠ¥ ê´€ë ¨ í•¨ìˆ˜ ---
        async function callGeminiAPI(prompt, schema = null) {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
            if (schema) {
                payload.generationConfig = {
                    responseMimeType: "application/json",
                    responseSchema: schema,
                };
            }
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    const errorBody = await response.json();
                    throw new Error(`API Error: ${errorBody.error.message}`);
                }
                const result = await response.json();
                if (result.candidates && result.candidates.length > 0) {
                    return result.candidates[0].content.parts[0].text;
                }
                throw new Error("AIë¡œë¶€í„° ìœ íš¨í•œ ë‹µë³€ì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
            } catch (error) {
                console.error("Gemini API í˜¸ì¶œ ì˜¤ë¥˜:", error);
                throw error;
            }
        }
        async function analyzePortfolio() {
            if (portfolioWithData.length === 0) { showErrorModal("ë¶„ì„í•  ì½”ì¸ì´ í¬íŠ¸í´ë¦¬ì˜¤ì— ì—†ìŠµë‹ˆë‹¤."); return; }
            const bodyHTML = '<div class="loader"></div>';
            openCustomModal("AI í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„ ì¤‘...", bodyHTML, '');
            const portfolioString = portfolioWithData.map(c => {
                const displayName = c.isManual ? c.name : (coinList.find(ci => ci.id === c.id)?.symbol.toUpperCase() || c.name);
                return `${displayName} ($${c.value.toFixed(2)})`;
            }).join(', ');
            const prompt = `ë‹¤ìŒì€ ì €ì˜ ì•”í˜¸í™”í í¬íŠ¸í´ë¦¬ì˜¤ì…ë‹ˆë‹¤: ${portfolioString}. ì´ í¬íŠ¸í´ë¦¬ì˜¤ì— ëŒ€í•´ ë‹¤ìŒ í•­ëª©ë“¤ì„ í•œêµ­ì–´ë¡œ, ì „ë¬¸ê°€ì²˜ëŸ¼ ìƒì„¸íˆ ë¶„ì„í•´ì£¼ì„¸ìš”: 1. **í¬íŠ¸í´ë¦¬ì˜¤ ìš”ì•½ ë° ìœ„í—˜ë„ í‰ê°€**: ì „ë°˜ì ì¸ í¬íŠ¸í´ë¦¬ì˜¤ì˜ ì„±ê²©(ê³µê²©ì , ì•ˆì •ì  ë“±)ê³¼ ìœ„í—˜ ìˆ˜ì¤€ì„ í‰ê°€í•´ì£¼ì„¸ìš”. 2. **ì£¼ìš” ì„¹í„° ë¶„ì„**: ê° ì½”ì¸ì´ ì–´ë–¤ ì„¹í„°(ì˜ˆ: ë ˆì´ì–´1, DeFi, AI, ë°ˆ, ì¸í”„ë¼ ë“±)ì— ì†í•˜ëŠ”ì§€ ë¶„ë¥˜í•˜ê³ , ì–´ë–¤ ì„¹í„°ì— íˆ¬ìê°€ ì§‘ì¤‘ë˜ì–´ ìˆëŠ”ì§€ ì•Œë ¤ì£¼ì„¸ìš”. ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€ëœ ìì‚°ì€ 'ê¸°íƒ€'ë¡œ ë¶„ë¥˜í•´ì£¼ì„¸ìš”. 3. **ë‹¤ê°í™” ì œì•ˆ**: í˜„ì¬ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ, ë¦¬ìŠ¤í¬ë¥¼ ì¤„ì´ê³  ìˆ˜ìµ ê¸°íšŒë¥¼ ë†’ì´ê¸° ìœ„í•œ ë‹¤ê°í™” ì „ëµì„ 2~3ê°€ì§€ ì œì•ˆí•´ì£¼ì„¸ìš”. ê²°ê³¼ëŠ” ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ, ê° í•­ëª©ì„ êµµì€ ê¸€ì”¨ì™€ ëª©ë¡ì„ ì‚¬ìš©í•˜ì—¬ ëª…í™•í•˜ê²Œ êµ¬ë¶„í•´ì„œ ë³´ì—¬ì£¼ì„¸ìš”.`;
            try {
                const analysisResult = await callGeminiAPI(prompt);
                updateModalContent("AI í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„", analysisResult);
            } catch (error) {
                updateModalContent("ì˜¤ë¥˜", `AI ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            }
        }
        async function getCoinNews(coinId) {
            const coinName = coinId.charAt(0).toUpperCase() + coinId.slice(1);
            const bodyHTML = '<div class="loader"></div>';
            openCustomModal(`${coinName} AI ë¦¬í¬íŠ¸ ìƒì„± ì¤‘...`, bodyHTML, '');
            const prompt = `ì•”í˜¸í™”í '${coinName}(${coinId})'ì— ëŒ€í•œ ìµœì‹  AI ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•´ì¤˜. ì•„ë˜ í•­ëª©ë“¤ì„ í¬í•¨í•´ì„œ í•œêµ­ì–´ë¡œ, ê°„ê²°í•˜ê³  ëª…í™•í•˜ê²Œ ì‘ì„±í•´ì¤˜: 1. **ìµœì‹  ì£¼ìš” ë‰´ìŠ¤ (3ê°€ì§€)**: ìµœê·¼ í•œ ë‹¬ ë‚´ì— ìˆì—ˆë˜ ê°€ì¥ ì¤‘ìš”í•œ ë‰´ìŠ¤ë‚˜ ì—…ë°ì´íŠ¸ 3ê°€ì§€ë¥¼ ìš”ì•½í•´ì¤˜. 2. **ë‹¨ê¸° ì‹œì¥ ì „ë§**: ì•ìœ¼ë¡œ 1~3ê°œì›” ë™ì•ˆì˜ ì‹œì¥ ì „ë§ì„ ê¸ì •ì , ì¤‘ë¦½ì , ë¶€ì •ì  ìš”ì¸ì„ ë“¤ì–´ ë¶„ì„í•´ì¤˜. 3. **í•µì‹¬ íˆ¬ì í¬ì¸íŠ¸**: ì´ ì½”ì¸ì— íˆ¬ìí•  ë•Œ ê³ ë ¤í•´ì•¼ í•  í•µì‹¬ì ì¸ ê¸°íšŒ ìš”ì¸ê³¼ ë¦¬ìŠ¤í¬ ìš”ì¸ì„ ê°ê° 1ê°€ì§€ì”© ì§šì–´ì¤˜. ê²°ê³¼ëŠ” ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ, ê° í•­ëª©ì„ êµµì€ ê¸€ì”¨ì™€ ëª©ë¡ì„ ì‚¬ìš©í•˜ì—¬ ëª…í™•í•˜ê²Œ êµ¬ë¶„í•´ì„œ ë³´ì—¬ì£¼ì„¸ìš”.`;
            try {
                const newsResult = await callGeminiAPI(prompt);
                updateModalContent(`${coinName} AI ë¦¬í¬íŠ¸`, newsResult);
            } catch (error) {
                updateModalContent("ì˜¤ë¥˜", `AI ë¦¬í¬íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            }
        }

        function openPredictionModal() {
            if (!portfolioWithData.some(c => c.id === 'bitcoin')) {
                showErrorModal("ë¯¸ë˜ ìì‚° ì˜ˆì¸¡ì€ í¬íŠ¸í´ë¦¬ì˜¤ì— ë¹„íŠ¸ì½”ì¸(BTC)ì´ í¬í•¨ë˜ì–´ ìˆì–´ì•¼ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                return;
            }
            const title = 'âœ¨ AI ë¯¸ë˜ ìì‚° ì˜ˆì¸¡';
            const bodyHTML = `
                <p class="mb-4">ë¹„íŠ¸ì½”ì¸ì´ ë¯¸ë˜ì— ëª‡ ë°° ì˜¤ë¥¼ ê²ƒìœ¼ë¡œ ì˜ˆìƒí•˜ì‹œë‚˜ìš”? ì˜ˆìƒ ë°°ìˆ˜ë¥¼ ì…ë ¥í•˜ë©´, AIê°€ ë‹¤ë¥¸ ì•ŒíŠ¸ì½”ì¸ë“¤ì˜ ì„±ì¥ë¥ ì„ ì¶”ë¡ í•˜ì—¬ ë¯¸ë˜ì˜ ìˆœìì‚°ì„ ì˜ˆì¸¡í•´ ë“œë¦½ë‹ˆë‹¤.</p>
                <input type="number" id="btc-multiplier" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆìƒ ë°°ìˆ˜ (ì˜ˆ: 3, 5, 10)">
            `;
            const footerHTML = `
                <button onclick="closeModal()" class="bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-md hover:bg-gray-400">ì·¨ì†Œ</button>
                <button onclick="predictFutureAssets()" class="bg-cyan-600 text-white font-bold py-2 px-4 rounded-md hover:bg-cyan-700">ì˜ˆì¸¡ ì‹œì‘</button>
            `;
            openCustomModal(title, bodyHTML, footerHTML);
        }

        async function predictFutureAssets() {
            const multiplierInput = document.getElementById('btc-multiplier');
            const btcMultiplier = parseFloat(multiplierInput.value);
            if (isNaN(btcMultiplier) || btcMultiplier <= 0) {
                showErrorModal("ì˜¬ë°”ë¥¸ ì˜ˆìƒ ë°°ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            document.getElementById('modal-body').innerHTML = '<div class="loader"></div>';
            document.getElementById('modal-footer').innerHTML = '';

            const altcoins = portfolioWithData.filter(c => c.id !== 'bitcoin' && !c.isManual);
            const altcoinNames = altcoins.map(c => c.name).join(', ');

            const prompt = `ì•”í˜¸í™”í ì‹œì¥ì—ì„œ ë¹„íŠ¸ì½”ì¸ì´ í˜„ì¬ë³´ë‹¤ ${btcMultiplier}ë°° ìƒìŠ¹í•œë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤. ì´ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ, ë‹¤ìŒ ì•ŒíŠ¸ì½”ì¸ ëª©ë¡ ê°ê°ì˜ ì˜ˆìƒ ìƒìŠ¹ ë°°ìˆ˜ë¥¼ ì¶”ë¡ í•´ì£¼ì„¸ìš”: ${altcoinNames}. ê° ì½”ì¸ì˜ íŠ¹ì„±, ì„¹í„°(ë ˆì´ì–´1, ë°ˆ, AI ë“±), ë¹„íŠ¸ì½”ì¸ê³¼ì˜ ìƒê´€ê´€ê³„ ë“±ì„ ê³ ë ¤í•˜ì—¬ í˜„ì‹¤ì ì¸ ì˜ˆì¸¡ì„ í•´ì£¼ì„¸ìš”. ê²°ê³¼ëŠ” ë°˜ë“œì‹œ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•´ì•¼ í•©ë‹ˆë‹¤.`;
            
            const schema = {
                type: "OBJECT",
                properties: {
                    "predictions": {
                        type: "ARRAY",
                        items: {
                            type: "OBJECT",
                            properties: {
                                "id": { "type": "STRING" },
                                "multiplier": { "type": "NUMBER" }
                            },
                            required: ["id", "multiplier"]
                        }
                    }
                }
            };

            try {
                const resultText = await callGeminiAPI(prompt, schema);
                const resultJson = JSON.parse(resultText);
                
                let futureTotalAssets = 0;
                const btcData = portfolioWithData.find(c => c.id === 'bitcoin');
                if (btcData) {
                    futureTotalAssets += btcData.value * btcMultiplier;
                }
                
                portfolioWithData.filter(c => c.isManual).forEach(manualAsset => {
                    futureTotalAssets += manualAsset.value; // ìˆ˜ë™ ìì‚°ì€ ê°€ì¹˜ ë³€ë™ ì—†ë‹¤ê³  ê°€ì •
                });

                const predictions = resultJson.predictions || [];
                altcoins.forEach(alt => {
                    const prediction = predictions.find(p => p.id === alt.id);
                    const altMultiplier = prediction ? prediction.multiplier : 1;
                    futureTotalAssets += alt.value * altMultiplier;
                });
                
                const futureNetAssets = futureTotalAssets - debt;
                displayPredictionResult(btcMultiplier, predictions, futureTotalAssets, futureNetAssets);

            } catch (error) {
                updateModalContent("ì˜¤ë¥˜", `AI ì˜ˆì¸¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            }
        }

        function displayPredictionResult(btcMultiplier, predictions, futureTotalAssets, futureNetAssets) {
            const formatUSD = (num) => `$${num.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            const formatKRW = (num) => `â‚©${num.toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;
            
            let resultHTML = `<div class="space-y-4">`;
            resultHTML += `<div><h4 class="font-bold text-lg">ğŸ“ˆ AI ì˜ˆì¸¡ ê²°ê³¼</h4><p>ë¹„íŠ¸ì½”ì¸ì´ <strong>${btcMultiplier}ë°°</strong> ìƒìŠ¹í•  ê²½ìš°, ê° ì•ŒíŠ¸ì½”ì¸ì˜ ì˜ˆìƒ ìƒìŠ¹ë¥ ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p></div>`;
            
            resultHTML += `<ul class="list-disc list-inside bg-gray-50 p-4 rounded-md">`;
            predictions.forEach(p => {
                const coinInfo = coinList.find(c => c.id === p.id);
                const ticker = coinInfo ? coinInfo.symbol.toUpperCase() : p.id;
                resultHTML += `<li><strong>${ticker}:</strong> ${p.multiplier.toFixed(1)}ë°° ìƒìŠ¹ ì˜ˆìƒ</li>`;
            });
            resultHTML += `</ul>`;

            resultHTML += `<div><h4 class="font-bold text-lg mt-4">ğŸ’° ë¯¸ë˜ ì˜ˆìƒ ìì‚°</h4></div>`;
            resultHTML += `<div class="grid grid-cols-2 gap-4 text-center bg-blue-50 p-4 rounded-md">`;
            resultHTML += `<div><p class="text-gray-600">ì˜ˆìƒ ì´ìì‚°</p><p class="font-bold text-xl">${formatUSD(futureTotalAssets)}</p></div>`;
            resultHTML += `<div><p class="text-gray-600">ì˜ˆìƒ ìˆœìì‚°</p><p class="font-bold text-xl text-blue-600">${formatUSD(futureNetAssets)}</p></div>`;
            resultHTML += `<div class="col-span-2"><p class="text-gray-600">ì˜ˆìƒ ìˆœìì‚° (KRW)</p><p class="font-bold text-xl text-green-600">${formatKRW(futureNetAssets * krwRate)}</p></div>`;
            resultHTML += `</div>`;
            
            resultHTML += `<p class="text-xs text-gray-500 mt-4">* ë³¸ ì˜ˆì¸¡ì€ AIì˜ ì¶”ë¡ ì— ê¸°ë°˜í•œ ê²ƒìœ¼ë¡œ, ì‹¤ì œ ì‹œì¥ ìƒí™©ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë©° íˆ¬ì ì¡°ì–¸ì´ ì•„ë‹™ë‹ˆë‹¤.</p>`;
            resultHTML += `</div>`;
            
            updateModalContent(`AI ë¯¸ë˜ ìì‚° ì˜ˆì¸¡ ê²°ê³¼`, resultHTML, true);
        }


        // --- ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ ---
        function openCustomModal(title, bodyHTML, footerHTML) {
            const modal = document.getElementById('ai-modal');
            const modalContent = modal.querySelector('.modal-content');
            const modalFooter = document.getElementById('modal-footer');
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-body').innerHTML = bodyHTML;
            if (footerHTML) {
                modalFooter.innerHTML = footerHTML;
                modalFooter.classList.remove('hidden');
            } else {
                modalFooter.innerHTML = '';
                modalFooter.classList.add('hidden');
            }
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                if(modalContent) modalContent.classList.remove('scale-95');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('ai-modal');
            const modalContent = modal.querySelector('.modal-content');
            modal.classList.add('opacity-0');
            if(modalContent) modalContent.classList.add('scale-95');
            setTimeout(() => modal.classList.add('hidden'), 300);
        }

        function updateModalContent(title, content, isHTML = false) {
            document.getElementById('modal-title').innerText = title;
            let finalContent = content;
            if (!isHTML) {
                finalContent = content
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\* (.*?)(<br>|$)/g, '<li>$1</li>')
                    .replace(/<br>/g, '');
                finalContent = `<ul>${finalContent}</ul>`.replace(/<\/li><li>/g, '</li><li>');
            }
            document.getElementById('modal-body').innerHTML = `<div class="prose max-w-none">${finalContent}</div>`;
            const modalFooter = document.getElementById('modal-footer');
            modalFooter.innerHTML = '';
            modalFooter.classList.add('hidden');
        }

        function showErrorModal(message) {
            const title = 'ì•Œë¦¼';
            const bodyHTML = `<p>${message}</p>`;
            const footerHTML = `<button onclick="closeModal()" class="bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-md hover:bg-gray-400 transition-colors">ë‹«ê¸°</button>`;
            openCustomModal(title, bodyHTML, footerHTML);
        }

        function showCoinSelectionModal(coins, quantity) {
            const title = `'${coins[0].symbol.toUpperCase()}' í‹°ì»¤ ì„ íƒ`;
            let bodyHTML = `<p>ë™ì¼í•œ í‹°ì»¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ì—¬ëŸ¬ ì½”ì¸ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì¶”ê°€í•  ì½”ì¸ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>`;
            bodyHTML += `<div class="mt-4 space-y-2">`;
            coins.forEach(coin => {
                bodyHTML += `<button onclick="selectCoinAndAdd('${coin.id}', ${quantity})" class="w-full text-left p-3 bg-gray-100 hover:bg-gray-200 rounded-md">${coin.name} (${coin.symbol.toUpperCase()})</button>`;
            });
            bodyHTML += `</div>`;
            const footerHTML = `<button onclick="closeModal()" class="bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-md hover:bg-gray-400">ì·¨ì†Œ</button>`;
            openCustomModal(title, bodyHTML, footerHTML);
        }

        function selectCoinAndAdd(id, quantity) {
            closeModal();
            processCoinAddition(id, quantity, false);
        }

        // --- ì´ˆê¸°í™” ë° ìë™ ê°±ì‹  ---
        setInterval(fetchData, 300000);
        
        window.addEventListener('DOMContentLoaded', async () => {
            const debtInput = document.getElementById('debt-input');
            if (debtInput) {
                debtInput.value = debt > 0 ? debt : '';
            }
            await fetchCoinList();
            await fetchData();
        });
    </script>
</body>
</html>
